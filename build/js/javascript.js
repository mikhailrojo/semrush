"use strict";var InputView=Backbone.View.extend({events:{"click #tagInput":"focusOnInputField","keydown #inputField":"keyDown","keyup #inputField":"keyUp"},myTemplate:_.template($("#mainContent").html()),render:function(){return this.$el.html(this.myTemplate(this.model.attributes)),this},focusOnInputField:function(){this.$("#inputField").focus()},internalVariable:null,keyDown:function(e){this._escPressed(e)},keyUp:function(e){var t=this.$("#inputField").val();t.length>0&&13!=e.keyCode|13!=e.which&&this._otherThanEnterPressed(t),t.length>18&&this._tooLongInput(),13===e.keyCode|13===e.which&&this._enterPressed(t)},returnedDataFromServer:null,xhrRequest:function(e,t){t.returnedDataFromServer?(console.log("запрос к кэшу"),t.createChoices(t.returnedDataFromServer,e,t)):$.ajax({method:"GET",url:"data.json"}).done(function(n){console.log("запрос к базе"),t.returnedDataFromServer=n,t.createChoices(n,e,t)})},createChoices:function(e,t,n){var i=new RegExp(t,"i"),r=this.$("#suggestions"),a=n.createNewTag;r.children().remove();for(var l=0;l<e.length;l++)if(e[l].match(i)){var o=document.createElement("li");o.addEventListener("click",function(e){a(e.target.innerText),$("#inputField").val(""),r.children().remove()}),o.innerText=e[l],r.append(o)}},createNewTag:function(e){var t=document.createElement("li"),n=document.createElement("span"),i=document.getElementById("tagUl");n.innerHTML="&times;",n.addEventListener("click",function(e){i.removeChild(e.target.parentNode)}),n.className="cross",t.className="tag",t.innerHTML=e,t.appendChild(n),i.insertBefore(t,inputLi),$("#inputField").focus()},_escPressed:function(e){var t=this.$("#tagUl"),n=t.children().length-2;!this.$("#inputField").val()&&t.children().length>1&&8===e.keyCode|8===e.which&&t.children()[n].remove()},_otherThanEnterPressed:function(e){this.intervalVariable?(clearInterval(this.intervalVariable),this._timeoutXhr(e)):this._timeoutXhr(e)},_timeoutXhr:function(e){var t=this.xhrRequest,n=this.intervalVariable,i=this;this.intervalVariable=setTimeout(function(){n=null,this.$("#inputField").val()&&t(e,i)},500)},_tooLongInput:function(){var e=$("#inputField").val();this.$("#inputField").val(e.substr(0,18)),$("#warning").length||($("#wrapper").append("<p id='warning'>Просим не вводить больше 18 символов</p>"),$("p#warning").css({color:"red",position:"absolute"}).fadeOut(3e3,function(){$(this).remove()}))},_enterPressed:function(e){this.$("#suggestions").html(""),e&&(this.createNewTag(e),this.$("#inputField").val(""))}}),myModel=new Backbone.Model({h1:"Заведение тэгов для Семруш",p:"Вводите в поле мужские и женские имена для добавления к выбранным:",line1:'*Сервер возвращает следующие имена: "Миша", "Алексей", "Владимир", "Тимофей", "Захар", "Матифей", "Леонид", "Александр", "Алеша", "Алек", "Татьяна", "Елена", "Нина", "Марина", "Елизавета"',line2:"*Для проверки работы, попробуйте начать вбивать любые буквы имени, и сервер предложит доступные варианты",line3:"*Имя возвращается тегом при нажатии Enter, либо при нажатии на выбранное имя из списка"}),view=new InputView({model:myModel});$("#main").append(view.render().el);